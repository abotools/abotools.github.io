<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Static Template</title>
  </head>
  <body>
    <div style="display: flex; flex-direction: row;">
      <div>
        <label for="day1">Anterior</label>
        <textarea id="day1"></textarea>
        <div id="result1"></div>
      </div>
      <div>
        <label for="day2">Atual</label>
        <textarea id="day2"></textarea>
        <div id="result2"></div>
      </div>
    </div>
    <button onclick="diff()">
      DO IT!
    </button>
    <div id="diff"></div>
  </body>
  <script>
    function processTable(table) {
      return table.split("\n").reduce(
        (acc, l) => {
          const cells = l.split("|").map((e) => e.trim());
          const curGS = cells[3].split("B")[0];
          acc[cells[0]] = curGS;
          acc.guild += parseFloat(curGS);
          return acc;
        },
        { guild: 0.0 }
      );
    }
    function formatNameGS(gsMap) {
      return Object.entries(gsMap)
        .map(([name, gs]) => `${name} - ${parseFloat(gs).toFixed(2)}`)
        .join("\n");
    }
    function diff() {
      const table1 = document.getElementById("day1").value;
      const table2 = document.getElementById("day2").value;
      const gsMap1 = processTable(table1);
      const gsMap2 = processTable(table2);
      document.getElementById("result1").innerText = formatNameGS(gsMap1);
      document.getElementById("result2").innerText = formatNameGS(gsMap2);

      const diffMap = Object.keys(gsMap2).reduce(
        (accDiff, pName) => {
          accDiff[pName] = gsMap2[pName] - gsMap1[pName];
          return accDiff;
        },
        { guild: 0.0 }
      );

      console.log(gsMap2.guild - gsMap1.guild);

      document.getElementById("diff").innerText = formatNameGS(diffMap);
    }
  </script>
</html>
